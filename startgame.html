<html>
    <head>
        <link rel="stylesheet" href="css/start.css">
    </head>
    <body>
        <hgroup>
        <img src="image/game/%E5%87%BA%E5%BE%81%E9%A0%90%E5%82%99.png">
        </hgroup>
        
        <div class="game-OutsideBlock">
        <div class="game-SelectBlock">
            <img src="image/game/Description.png" class="game-Description01">
            <div id="game-country1">
                <img src="image/game/game-country1.png" id="game-img-country1" class="game-img-country">
            </div>
            <div id="game-country2">
                <img src="image/game/game-country2.png" id="game-img-country2" class="game-img-country">
            </div>
            
        </div>
        <div class="game-SelectBlock">
            <table>
                <tr>
                    <td>
                        <img src="image/cardback.png" class="game-card game-card-new-col1"  draggable="true" name="1">
                        <img src="image/cardback.png" class="game-card" draggable="false"></td>
                    <td>
                        <img src="image/cardback.png" class="game-card game-card-new-col1" draggable="true" name="2">
                        <img src="image/cardback.png" class="game-card" draggable="false"></td>
                    <td>
                        <img src="image/cardback.png" class="game-card game-card-new-col1" draggable="true" name="3">
                        <img src="image/cardback.png" class="game-card" draggable="false"></td>
                </tr>
                <tr>
                    <td>
                        <img src="image/cardback.png" class="game-card game-card-new-col2" draggable="true" name="4">
                        <img src="image/cardback.png" class="game-card"></td>
                    <td>
                        <img src="image/cardback.png" class="game-card game-card-new-col2" draggable="true" name="5">
                        <img src="image/cardback.png" class="game-card"></td>
                    <td>
                        <img src="image/cardback.png" class="game-card game-card-new-col2" draggable="true" name="6">
                        <img src="image/cardback.png" class="game-card"></td>
                </tr>
            </table> 
        </div>
        <div class="game-SelectBlock">
            <div class=game-team-first>
                <img src="image/game/%E5%85%88%E7%99%BC.png" class=game-team-bg>
                <div class=game-team-seat dropzone="move string:text/plain" ondrop="dropHandler(event)" ondragover="dragoverHandler(event)" data-seat="1" name="seat1"></div>
                <div class=game-team-seat dropzone="move string:text/plain" ondrop="dropHandler(event)" ondragover="dragoverHandler(event)" data-seat="2" name="seat2"></div>
                <div class=game-team-seat dropzone="move string:text/plain" ondrop="dropHandler(event)" ondragover="dragoverHandler(event)" data-seat="3" name="seat3"></div>
            </div>
            <div class=game-team-second>
                <img src="image/game/%E6%9B%BF%E8%A3%9C.png" class=game-team-bg>
                <div class=game-team-seat dropzone="move string:text/plain" ondrop="dropHandler(event)" ondragover="dragoverHandler(event)" data-seat="4" name="seat4" style="width:33%"></div>
                <div class=game-team-seat dropzone="move string:text/plain" ondrop="dropHandler(event)" ondragover="dragoverHandler(event)" data-seat="5" name="seat5" style="width:33%"></div>
            </div>
            <img src="image/game/game-startbtn-noready.png" class=game-startbtn>
        </div>
            
        </div>
        <div class="game-nextSelectBlock"><img src="image/play-button.png"></div>
        <div class="game-beforeSelectBlock"><img src="image/play-button.png"></div>
        
    </body>
    <script src="card.json" type="text/javascript" charset="utf-8"></script>
    <script>
        var country=new Array(2);
        country[0]=document.getElementById("game-img-country1");
        country[1]=document.getElementById("game-img-country2");
        
        var cardcol=new Array(2);
        cardcol[0]=document.getElementsByClassName("game-card-new-col1");
        cardcol[1]=document.getElementsByClassName("game-card-new-col2");
        
        var nowcard=document.getElementsByClassName("game-card");
        country[0].addEventListener("click",function(){
            localStorage.setItem("country","A");
        if(!this.classList.contains("game-img-country-visible")){
            this.classList.add("game-img-country-visible");
            country[1].classList.remove("game-img-country-visible");
            
            if(nowcard[0].classList.contains("game-card-animation")){
                for(var i=0;i<nowcard.length;i++){
                    nowcard[i].classList.add("game-card-animation-reverse");
                    nowcard[i].classList.remove("game-card-animation");

                }
                setTimeout(function(){
                for(var i=0;i<2;i++){
                    for(var j=0;j<3;j++){
                        cardcol[i][j].setAttribute("src",card[i*3+j]["img"]);
                        cardcol[i][j].setAttribute("data-name",card[i*3+j]["name"]);
                    }
                }
                for(var i=0;i<nowcard.length;i++){
                        nowcard[i].classList.remove("game-card-animation-reverse");
                        nowcard[i].classList.add("game-card-animation");
                    }
                },150);
            }
            else{
                for(var i=0;i<2;i++){
                    for(var j=0;j<3;j++){
                        cardcol[i][j].setAttribute("src",card[i*3+j]["img"]);
                        cardcol[i][j].setAttribute("data-name",card[i*3+j]["name"]);
                    }
                }
                for(var i=0;i<nowcard.length;i++)
                nowcard[i].classList.add("game-card-animation");
            }
            document.getElementsByClassName("game-nextSelectBlock")[0].classList.add("game-arrow-visible");
        }    
        })
        country[1].addEventListener("click",function(){
            localStorage.setItem("country","B");
        if(!this.classList.contains("game-img-country-visible")){
            this.classList.add("game-img-country-visible");
            country[0].classList.remove("game-img-country-visible");
            if(nowcard[0].classList.contains("game-card-animation")){
                for(var i=0;i<nowcard.length;i++){
                    nowcard[i].classList.add("game-card-animation-reverse");
                    nowcard[i].classList.remove("game-card-animation");

                }
                setTimeout(function(){
                for(var i=0;i<2;i++){
                    for(var j=0;j<3;j++){
                        cardcol[i][j].setAttribute("src",card[6+i*3+j]["img"]);
                        cardcol[i][j].setAttribute("data-name",card[6+i*3+j]["name"]);
                    }
                }
                for(var i=0;i<nowcard.length;i++){
                        nowcard[i].classList.remove("game-card-animation-reverse");
                        nowcard[i].classList.add("game-card-animation");
                    }
                },150);
            }
            else{
                for(var i=0;i<2;i++){
                    for(var j=0;j<3;j++){
                        cardcol[i][j].setAttribute("src",card[6+i*3+j]["img"]);
                        cardcol[i][j].setAttribute("data-name",card[6+i*3+j]["name"]);
                    }
                }
                for(var i=0;i<nowcard.length;i++)
                nowcard[i].classList.add("game-card-animation");
            }
            document.getElementsByClassName("game-nextSelectBlock")[0].classList.add("game-arrow-visible");
        }
        })
        document.getElementsByClassName("game-nextSelectBlock")[0].addEventListener("click",function(){
            document.getElementsByClassName("game-OutsideBlock")[0].classList.add("game-tonextSelectBlock");
            this.classList.remove("game-arrow-visible");
            setTimeout(function(){
                document.getElementsByClassName("game-beforeSelectBlock")[0].classList.add("game-arrow-visible");
            },2000);
            
        });
        document.getElementsByClassName("game-beforeSelectBlock")[0].addEventListener("click",function(){
            document.getElementsByClassName("game-OutsideBlock")[0].classList.add("game-tobeforeSelectBlock");
            this.classList.remove("game-arrow-visible");
            
            /*復原卡牌*/
            for(var i=0;i<findcard.length;i++){
                if(findcard[i].classList.contains("game-card-visible")){
                    findcard[i].classList.remove("game-card-visible");
                }
            }
            for(var i=1;i<6;i++){
                localStorage.removeItem(i);
                console.log(document.getElementsByName("seat"+i)[0].hasChildNodes());
                if(document.getElementsByName("seat"+i)[0].hasChildNodes()){
                    var child=document.getElementsByName("seat"+i)[0].childNodes[0];
                    document.getElementsByName("seat"+i)[0].removeChild(child);
                }
            }
            
            
            setTimeout(function(){
                document.getElementsByClassName("game-nextSelectBlock")[0].classList.add("game-arrow-visible");
                document.getElementsByClassName("game-OutsideBlock")[0].classList.remove("game-tonextSelectBlock");
                document.getElementsByClassName("game-OutsideBlock")[0].classList.remove("game-tobeforeSelectBlock");
            },2000);
        })
        
    </script>
    <script>
        localStorage.clear();
        var findcard=document.getElementsByClassName("game-card");
        var startbtn=document.getElementsByClassName("game-startbtn");
        var flagEverOK=false; //check startbtn
        function dropHandler(event){
            var img=document.createElement("img");
            img.src=event.dataTransfer.getData("text/plain");
            var name=img.src.charAt(img.src.length-5);
            if(event.target.tagName!="IMG"){
                event.target.appendChild(img);
                img.addEventListener("mouseup",function(e){
                    if(e.button==2){
                        var name=this.src.charAt(img.src.length-5);
                        for(var i=1;i<6;i++){
                            if(localStorage.getItem(i)==name){
                                localStorage.removeItem(i);
                                var child=document.getElementsByName("seat"+i)[0].childNodes[0];
                                document.getElementsByName("seat"+i)[0].removeChild(child);
                            }
                        }
                        for(var i=0;i<findcard.length;i++){
                        if(name==findcard[i].getAttribute("name")){
                            findcard[i].classList.remove("game-card-visible");
                            break;
                            }
                        }
                        if(checkcard()){
                            flagEverOK=true;
                            startbtn[0].setAttribute("src","image/game/game-startbtn.png");
                            startbtn[0].addEventListener("mousemove",startbtnhover);
                            startbtn[0].addEventListener("mouseout",startbtnout);
                            startbtn[0].addEventListener("click",startbtnclick);
                        }
                        else if(flagEverOK){
                            flagEverOK=false;
                            startbtn[0].setAttribute("src","image/game/game-startbtn-noready.png");
                            startbtn[0].removeEventListener("mousemove",startbtnhover);
                            startbtn[0].removeEventListener("mouseout",startbtnout);
                            startbtn[0].removeEventListener("click",startbtnclick);
                        }
                    }
                })
                for(var i=1;i<6;i++){
                    if(localStorage.getItem(i)==name){
                        localStorage.removeItem(i);
                        var child=document.getElementsByName("seat"+i)[0].childNodes[0];
                        document.getElementsByName("seat"+i)[0].removeChild(child);
                    }
                }
                localStorage.setItem(event.target.getAttribute("data-seat"),name);
                for(var i=0;i<findcard.length;i++){
                if(name==findcard[i].getAttribute("name")){
                    findcard[i].classList.add("game-card-visible");
                    break;
                    }
                }
            }
            
            if(checkcard()){
                flagEverOK=true;
                startbtn[0].setAttribute("src","image/game/game-startbtn.png");
                startbtn[0].addEventListener("mousemove",startbtnhover);
                startbtn[0].addEventListener("mouseout",startbtnout);
                startbtn[0].addEventListener("click",startbtnclick);
            }
            else if(flagEverOK){
                flagEverOK=false;
                startbtn[0].setAttribute("src","image/game/game-startbtn-noready.png");
                startbtn[0].removeEventListener("mousemove",startbtnhover);
                startbtn[0].removeEventListener("mouseout",startbtnout);
                startbtn[0].removeEventListener("click",startbtnclick);
            }
        }
        function dragoverHandler(event){
                event.preventDefault();
            }
        document.oncontextmenu=function(){return false};
        function checkcard(){
            for(var i=1;i<6;i++){
               if(localStorage.getItem(i)==null){
                   return false;
               }
            }
            return true;
        }
        function startbtnhover(){
            startbtn[0].setAttribute("src","image/game/game-startbtn-hover.png")
        }
        function startbtnout(){
            startbtn[0].setAttribute("src","image/game/game-startbtn.png");
        }
        function startbtnclick(){
            document.location.href="game.html";
        }
     </script>
</html>